{% extends "admin/base.html" %}

{% block title %}{{ 'Редактировать администратора' if user else 'Новый администратор' }}{% endblock %}

{% block breadcrumbs %}
<a href="/admin" class="admin-breadcrumbs__item">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
    </svg>
</a>
<span class="admin-breadcrumbs__separator">/</span>
<a href="/admin/users" class="admin-breadcrumbs__item">Администраторы</a>
<span class="admin-breadcrumbs__separator">/</span>
<span class="admin-breadcrumbs__current">{{ 'Редактирование' if user else 'Создание' }}</span>
{% endblock %}

{% block content %}
<form method="POST" action="{{ '/admin/users/' + user.id|string if user else '/admin/users' }}" class="form-page">
    <!-- Sticky Header -->
    <div class="form-sticky-header">
        <div class="form-sticky-header__left">
            <a href="/admin/users" class="btn btn--icon" title="Назад к списку">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
            </a>
            <div class="form-sticky-header__title">
                <h1>{{ 'Редактировать администратора' if user else 'Новый администратор' }}</h1>
                <span class="form-sticky-header__status" id="formStatus">
                    {% if user %}
                    <span class="status-dot status-dot--{{ 'success' if user.is_active else 'warning' }}"></span>
                    {{ 'Активен' if user.is_active else 'Заблокирован' }}
                    {% else %}
                    Черновик
                    {% endif %}
                </span>
            </div>
        </div>
        <div class="form-sticky-header__actions">
            <a href="/admin/users" class="btn btn--secondary">Отмена</a>
            <button type="submit" class="btn btn--primary">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                    <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
                {{ 'Сохранить' if user else 'Создать' }}
            </button>
        </div>
    </div>

    <div class="form-layout form-layout--narrow">
        <!-- Main Content -->
        <div class="form-layout__main">
            <!-- User Data -->
            <div class="form-card">
                <div class="form-card__header">
                    <h3 class="form-card__title">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Данные пользователя
                    </h3>
                </div>
                <div class="form-card__body">
                    <div class="form-group">
                        <label for="username" class="form-label form-label--required">Имя пользователя</label>
                        <input
                            type="text"
                            id="username"
                            name="username"
                            class="form-input"
                            value="{{ user.username if user else '' }}"
                            required
                            autocomplete="username"
                            placeholder="Введите логин"
                        >
                    </div>

                    <div class="form-group">
                        <label for="password" class="form-label {% if not user %}form-label--required{% endif %}">
                            Пароль
                            {% if user %}
                            <span class="form-label__hint">(оставьте пустым, чтобы не менять)</span>
                            {% endif %}
                        </label>
                        <input
                            type="password"
                            id="password"
                            name="password"
                            class="form-input"
                            {% if not user %}required{% endif %}
                            autocomplete="new-password"
                            placeholder="{% if user %}Новый пароль{% else %}Введите пароль{% endif %}"
                            minlength="6"
                        >
                        <span class="form-hint">Минимум 6 символов</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="form-layout__sidebar">
            <!-- Status -->
            <div class="form-card">
                <div class="form-card__header">
                    <h3 class="form-card__title">Статус</h3>
                </div>
                <div class="form-card__body">
                    <div class="form-toggle-group">
                        <label class="form-toggle">
                            <input type="checkbox" name="is_active" value="true" id="isActive"
                                   {% if user and user.is_active %}checked{% endif %}
                                   {% if not user %}checked{% endif %}>
                            <span class="form-toggle__slider"></span>
                            <span class="form-toggle__label">
                                <strong>Активен</strong>
                                <small>Может входить в систему</small>
                            </span>
                        </label>
                    </div>
                </div>
            </div>

            {% if user %}
            <!-- Info -->
            <div class="form-card form-card--muted">
                <div class="form-card__body">
                    <div class="form-info-list">
                        <div class="form-info-item">
                            <span class="form-info-item__label">ID</span>
                            <span class="form-info-item__value">{{ user.id }}</span>
                        </div>
                        <div class="form-info-item">
                            <span class="form-info-item__label">Последний вход</span>
                            <span class="form-info-item__value">
                                {{ user.last_login.strftime('%d.%m.%Y %H:%M') if user.last_login else 'Никогда' }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
// Update status indicator when checkbox changes
document.getElementById('isActive')?.addEventListener('change', function() {
    const statusEl = document.getElementById('formStatus');
    if (statusEl) {
        const dot = statusEl.querySelector('.status-dot');
        if (dot) {
            dot.classList.toggle('status-dot--success', this.checked);
            dot.classList.toggle('status-dot--warning', !this.checked);
        }
        const text = statusEl.childNodes[statusEl.childNodes.length - 1];
        if (text) {
            text.textContent = this.checked ? 'Активен' : 'Заблокирован';
        }
    }
});
</script>
{% endblock %}
